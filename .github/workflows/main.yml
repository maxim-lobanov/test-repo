on: [ push, workflow_dispatch ]

jobs:
  rider:
    name: Rider
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - run: |
       cat $HOME/.docker/config.json
    - run: |
        docker logout
        rm -f $HOME/.docker/config.json
    - run: |
        pass init "maxim"
        echo "{" > $HOME/.docker/config.json
        echo '  "credsStore": "pass"' >> $HOME/.docker/config.json
        echo "}" >> $HOME/.docker/config.json
        cat $HOME/.docker/config.json
    - run: |
        wget https://github.com/docker/docker-credential-helpers/releases/download/v0.6.3/docker-credential-pass-v0.6.3-amd64.tar.gz
        tar -xf docker-credential-pass-v0.6.3-amd64.tar.gz
        chmod +x docker-credential-pass
        mv docker-credential-pass /usr/local/bin/
    - run: |
        which docker-credential-pass
        docker-credential-pass version
        docker-credential-pass list
    - run: |
        docker login -u githubactions -p 3d6472b9-3d49-4d17-9fc9-90d24258043b
    - run: |
        cat $HOME/.docker/config.json
